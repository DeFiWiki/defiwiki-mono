{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _objectSpread = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/objectSpread2\");\n\nvar _asyncToGenerator = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"C:/not-sync/git2/defiwiki-mono/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StreamStatic = exports.Stream = exports.CommitType = exports.AnchorStatus = exports.SignatureStatus = void 0;\n\nvar lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\n\nvar streamid_1 = require(\"@ceramicnetwork/streamid\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar docopts_1 = require(\"./docopts\");\n\nvar SignatureStatus;\n\n(function (SignatureStatus) {\n  SignatureStatus[SignatureStatus[\"GENESIS\"] = 0] = \"GENESIS\";\n  SignatureStatus[SignatureStatus[\"PARTIAL\"] = 1] = \"PARTIAL\";\n  SignatureStatus[SignatureStatus[\"SIGNED\"] = 2] = \"SIGNED\";\n})(SignatureStatus = exports.SignatureStatus || (exports.SignatureStatus = {}));\n\nvar AnchorStatus;\n\n(function (AnchorStatus) {\n  AnchorStatus[AnchorStatus[\"NOT_REQUESTED\"] = 0] = \"NOT_REQUESTED\";\n  AnchorStatus[AnchorStatus[\"PENDING\"] = 1] = \"PENDING\";\n  AnchorStatus[AnchorStatus[\"PROCESSING\"] = 2] = \"PROCESSING\";\n  AnchorStatus[AnchorStatus[\"ANCHORED\"] = 3] = \"ANCHORED\";\n  AnchorStatus[AnchorStatus[\"FAILED\"] = 4] = \"FAILED\";\n})(AnchorStatus = exports.AnchorStatus || (exports.AnchorStatus = {}));\n\nvar CommitType;\n\n(function (CommitType) {\n  CommitType[CommitType[\"GENESIS\"] = 0] = \"GENESIS\";\n  CommitType[CommitType[\"SIGNED\"] = 1] = \"SIGNED\";\n  CommitType[CommitType[\"ANCHOR\"] = 2] = \"ANCHOR\";\n})(CommitType = exports.CommitType || (exports.CommitType = {}));\n\nvar Stream = /*#__PURE__*/function (_rxjs_1$Observable) {\n  _inherits(Stream, _rxjs_1$Observable);\n\n  var _super = _createSuper(Stream);\n\n  function Stream(state$, _context) {\n    var _this;\n\n    _classCallCheck(this, Stream);\n\n    _this = _super.call(this, function (subscriber) {\n      state$.subscribe(subscriber);\n    });\n    _this.state$ = state$;\n    _this._context = _context;\n    return _this;\n  }\n\n  _createClass(Stream, [{\n    key: \"id\",\n    get: function get() {\n      return new streamid_1.StreamID(this.state$.value.type, this.state$.value.log[0].cid);\n    }\n  }, {\n    key: \"api\",\n    get: function get() {\n      return this._context.api;\n    }\n  }, {\n    key: \"metadata\",\n    get: function get() {\n      var _a;\n\n      var _this$state$$value = this.state$.value,\n          next = _this$state$$value.next,\n          metadata = _this$state$$value.metadata;\n      return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.metadata) !== null && _a !== void 0 ? _a : metadata);\n    }\n  }, {\n    key: \"controllers\",\n    get: function get() {\n      return this.metadata.controllers;\n    }\n  }, {\n    key: \"tip\",\n    get: function get() {\n      return this.state$.value.log[this.state$.value.log.length - 1].cid;\n    }\n  }, {\n    key: \"commitId\",\n    get: function get() {\n      return this.id.atCommit(this.tip);\n    }\n  }, {\n    key: \"allCommitIds\",\n    get: function get() {\n      var _this2 = this;\n\n      return this.state$.value.log.map(function (_ref) {\n        var cid = _ref.cid;\n        return _this2.id.atCommit(cid);\n      });\n    }\n  }, {\n    key: \"anchorCommitIds\",\n    get: function get() {\n      var _this3 = this;\n\n      return this.state$.value.log.filter(function (_ref2) {\n        var type = _ref2.type;\n        return type === CommitType.ANCHOR;\n      }).map(function (_ref3) {\n        var cid = _ref3.cid;\n        return _this3.id.atCommit(cid);\n      });\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return lodash_clonedeep_1.default(this.state$.value);\n    }\n  }, {\n    key: \"sync\",\n    value: function () {\n      var _sync = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var opts,\n            stream,\n            _args = arguments;\n        return _regeneratorRuntime.wrap(function _callee$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                opts = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n                opts = _objectSpread({\n                  sync: docopts_1.SyncOptions.PREFER_CACHE\n                }, opts);\n                _context2.next = 4;\n                return this.api.loadStream(this.id, opts);\n\n              case 4:\n                stream = _context2.sent;\n                this.state$.next(stream.state);\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function sync() {\n        return _sync.apply(this, arguments);\n      }\n\n      return sync;\n    }()\n  }, {\n    key: \"_getContent\",\n    value: function _getContent() {\n      var _a;\n\n      var _this$state$$value2 = this.state$.value,\n          next = _this$state$$value2.next,\n          content = _this$state$$value2.content;\n      return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.content) !== null && _a !== void 0 ? _a : content);\n    }\n  }]);\n\n  return Stream;\n}(rxjs_1.Observable);\n\nexports.Stream = Stream;\n\nfunction StreamStatic() {\n  return function (constructor) {\n    constructor;\n  };\n}\n\nexports.StreamStatic = StreamStatic;","map":{"version":3,"sources":["../src/stream.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StreamStatic = exports.Stream = exports.CommitType = exports.AnchorStatus = exports.SignatureStatus = void 0;\nconst lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nconst streamid_1 = require(\"@ceramicnetwork/streamid\");\nconst rxjs_1 = require(\"rxjs\");\nconst docopts_1 = require(\"./docopts\");\nvar SignatureStatus;\n(function (SignatureStatus) {\n    SignatureStatus[SignatureStatus[\"GENESIS\"] = 0] = \"GENESIS\";\n    SignatureStatus[SignatureStatus[\"PARTIAL\"] = 1] = \"PARTIAL\";\n    SignatureStatus[SignatureStatus[\"SIGNED\"] = 2] = \"SIGNED\";\n})(SignatureStatus = exports.SignatureStatus || (exports.SignatureStatus = {}));\nvar AnchorStatus;\n(function (AnchorStatus) {\n    AnchorStatus[AnchorStatus[\"NOT_REQUESTED\"] = 0] = \"NOT_REQUESTED\";\n    AnchorStatus[AnchorStatus[\"PENDING\"] = 1] = \"PENDING\";\n    AnchorStatus[AnchorStatus[\"PROCESSING\"] = 2] = \"PROCESSING\";\n    AnchorStatus[AnchorStatus[\"ANCHORED\"] = 3] = \"ANCHORED\";\n    AnchorStatus[AnchorStatus[\"FAILED\"] = 4] = \"FAILED\";\n})(AnchorStatus = exports.AnchorStatus || (exports.AnchorStatus = {}));\nvar CommitType;\n(function (CommitType) {\n    CommitType[CommitType[\"GENESIS\"] = 0] = \"GENESIS\";\n    CommitType[CommitType[\"SIGNED\"] = 1] = \"SIGNED\";\n    CommitType[CommitType[\"ANCHOR\"] = 2] = \"ANCHOR\";\n})(CommitType = exports.CommitType || (exports.CommitType = {}));\nclass Stream extends rxjs_1.Observable {\n    constructor(state$, _context) {\n        super(subscriber => {\n            state$.subscribe(subscriber);\n        });\n        this.state$ = state$;\n        this._context = _context;\n    }\n    get id() {\n        return new streamid_1.StreamID(this.state$.value.type, this.state$.value.log[0].cid);\n    }\n    get api() {\n        return this._context.api;\n    }\n    get metadata() {\n        var _a;\n        const { next, metadata } = this.state$.value;\n        return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.metadata) !== null && _a !== void 0 ? _a : metadata);\n    }\n    get controllers() {\n        return this.metadata.controllers;\n    }\n    get tip() {\n        return this.state$.value.log[this.state$.value.log.length - 1].cid;\n    }\n    get commitId() {\n        return this.id.atCommit(this.tip);\n    }\n    get allCommitIds() {\n        return this.state$.value.log.map(({ cid }) => this.id.atCommit(cid));\n    }\n    get anchorCommitIds() {\n        return this.state$.value.log\n            .filter(({ type }) => type === CommitType.ANCHOR)\n            .map(({ cid }) => this.id.atCommit(cid));\n    }\n    get state() {\n        return lodash_clonedeep_1.default(this.state$.value);\n    }\n    async sync(opts = {}) {\n        opts = { sync: docopts_1.SyncOptions.PREFER_CACHE, ...opts };\n        const stream = await this.api.loadStream(this.id, opts);\n        this.state$.next(stream.state);\n    }\n    _getContent() {\n        var _a;\n        const { next, content } = this.state$.value;\n        return lodash_clonedeep_1.default((_a = next === null || next === void 0 ? void 0 : next.content) !== null && _a !== void 0 ? _a : content);\n    }\n}\nexports.Stream = Stream;\nfunction StreamStatic() {\n    return (constructor) => { constructor; };\n}\nexports.StreamStatic = StreamStatic;\n//# sourceMappingURL=stream.js.map"]},"metadata":{},"sourceType":"script"}